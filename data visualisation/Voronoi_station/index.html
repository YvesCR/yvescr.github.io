<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>How Far am I From the Next Tube Station? - Data laborer</title>




<meta name="description" content="How to find the furthest point from a London tube station with Voronoi">




<meta property="og:locale" content="en">
<meta property="og:site_name" content="Data laborer">
<meta property="og:title" content="How Far am I From the Next Tube Station?">


  <link rel="canonical" href="https://data-laborer.eu/data%20visualisation/Voronoi_station/">
  <meta property="og:url" content="https://data-laborer.eu/data%20visualisation/Voronoi_station/">



  <meta property="og:description" content="How to find the furthest point from a London tube station with Voronoi">



  <meta name="twitter:site" content="@SwiftAMHE">
  <meta name="twitter:title" content="How Far am I From the Next Tube Station?">
  <meta name="twitter:description" content="How to find the furthest point from a London tube station with Voronoi">
  <meta name="twitter:url" content="https://data-laborer.eu/data%20visualisation/Voronoi_station/">

  
    <meta name="twitter:card" content="summary">
    
  

  







  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2015-07-16T00:00:00+01:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Yves Crutain",
      "url" : "https://data-laborer.eu",
      "sameAs" : ["https://twitter.com/swiftamhe","https://www.linkedin.com/in/yves-crutain-0b430324"]
    }
  </script>






<!-- end SEO -->


<link href="https://data-laborer.eu/feed.xml" type="application/atom+xml" rel="alternate" title="Data laborer Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://data-laborer.eu/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://data-laborer.eu/">Data laborer</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/portfolio/">List View</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/categories/">Categories</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/tags/">Tags</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/about/index.html">About</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    



<div id="main" role="main">
  

  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="How Far am I From the Next Tube Station?">
    <meta itemprop="description" content="How to find the furthest point from a London tube station with Voronoi">
    <meta itemprop="datePublished" content="July 16, 2015">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">How Far am I From the Next Tube Station?
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  9 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>A question was uplifted at the last R coding dojo. What is the location in central London which is the furthest from the subway?</p>

<p>The first bit of code of this question was made at the LondonR coding dojo, here:</p>

<p>https://github.com/London-R-Dojo/Dojo-repo/tree/master/July-2015-Dojo</p>

<p>Two approach was used to reply to this question:</p>

<p>-Mapping the point depending on the distance from the subway</p>

<p>-Using Voronoi diagram to analytically determine the furthest point.</p>

<p>The first approach produced a really nice plot of London when the second approach failed to pass the question of the border of an area,</p>

<p>In this blog post, I try to override this issue.</p>

<h1> Method </h1>

<p>In the alphahull package, the <code class="highlighter-rouge">ashape</code> function allows to create a close constraint, based on voronoi. It calculates both the constraint and the voronoi vertices.</p>

<p>The function <code class="highlighter-rouge">pnt.in.poly</code> of the SDMTools allow to flag the voronoi vertices which are inside the constraint.</p>

<p>Combining both allows me to create a constraint Voronoi diagram in which I could look for the point the furthest from any subway station.</p>

<p><img src="/image/London.gif" alt="london gif " /></p>

<h1> The code </h1>

<h3> Libraries, data, raw map </h3>

<p>Coordinates of stations could be found on the TFL website.
The function <code class="highlighter-rouge">get_map()</code> plot a map in a really efficient way and quite fast.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">alphahull</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">SDMTools</span><span class="p">)</span><span class="w"> 
</span><span class="n">library</span><span class="p">(</span><span class="n">devtools</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">animation</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ImageMagick</span><span class="p">)</span><span class="w">

</span><span class="c1"># load the libraries:
</span><span class="n">l</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"data.table"</span><span class="p">,</span><span class="w"> </span><span class="s2">"alphahull"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ggmap"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SDMTools"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sp"</span><span class="p">),</span><span class="w"> </span><span class="n">require</span><span class="p">,</span><span class="w"> </span><span class="n">character.only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">

  </span><span class="c1"># First, get the data:
</span><span class="n">coord.station</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fread</span><span class="p">(</span><span class="s2">"tfl.stations.csv"</span><span class="p">)</span><span class="w">

  </span><span class="c1"># Get the map of London:
</span><span class="n">london12</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_map</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"London"</span><span class="p">,</span><span class="w"> </span><span class="n">zoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w">
</span><span class="n">zones.london.plot12</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggmap</span><span class="p">(</span><span class="n">london12</span><span class="p">,</span><span class="w"> </span><span class="n">maprange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w"> 

  </span><span class="c1"># only zones 1 &amp; inside the plot:
</span><span class="n">coord.station</span><span class="p">[,</span><span class="w"> </span><span class="n">zone2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"dlr"</span><span class="p">,</span><span class="w"> </span><span class="s2">"dlr"</span><span class="p">,</span><span class="w"> </span><span class="n">zone</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">coord.station.min</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">coord.station</span><span class="p">[</span><span class="n">zone</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">zone2</span><span class="p">)]</span><span class="w">

  </span><span class="c1"># plot stations
</span><span class="n">zones.london</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">zones.london.plot12</span><span class="w"> </span><span class="o">+</span><span class="w">
          </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coord.station.min</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">zone2</span><span class="p">)),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
          </span><span class="n">scale_colour_discrete</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Zone"</span><span class="p">)</span></code></pre></figure>

<h3> Voronoi &amp; constraint calculation </h3>

<p>The alpha parameter control the alpha-shape. The smallest the value, the more complicated the constraint.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="w">  </span><span class="c1"># voronoi and constraint:
</span><span class="n">alphashape</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ashape</span><span class="p">(</span><span class="n">coord.station.min</span><span class="o">$</span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">coord.station.min</span><span class="o">$</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.021</span><span class="p">)</span><span class="w">

  </span><span class="c1"># voronoi summits:
</span><span class="n">voronoi.full</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.table</span><span class="p">(</span><span class="n">alphashape</span><span class="o">$</span><span class="n">delvor.obj</span><span class="o">$</span><span class="n">mesh</span><span class="p">)</span><span class="w">
</span><span class="n">polygon.ext</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">alphashape</span><span class="o">$</span><span class="n">edges</span><span class="p">)</span><span class="w">

</span><span class="c1"># plot the voronoi diagram without constraint:
</span><span class="n">plot.no.map.voronoi</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">zones.london</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_segment</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">voronoi.full</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mx1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my1</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mx2</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my2</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">0.25</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_segment</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">polygon.ext</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">0.25</span><span class="p">)</span><span class="w">
</span><span class="n">plot.no.map.voronoi</span></code></pre></figure>

<p><img src="http://data-laborer.eu/assets/images/figures/source/2015-07-16-Voronoi_station/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /></p>

<p>Now, we have the constraint and the voronoi diagram on all the subways station of the zone 1.</p>

<h3> Keep voronoi summits inside the constraint </h3>

<p>As I want to keep only the voronoi summit inside the constraint, I use the function <code class="highlighter-rouge">pnt.in.poly</code> to flag summit outside the constraint.</p>

<p>The function takes only the ordered summit of the constraint as the polygon. The first loop reorder the summits.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="w"> </span><span class="c1">## problem: voronoi summit are outside the polygon.
</span><span class="w">  </span><span class="c1">#we are looking for the voronoi summits which are inside the polygon.
</span><span class="w">  </span><span class="c1"># our issue here is that the function pnt.in.polygon need an ordered table of the summit.
</span><span class="w">  </span><span class="c1"># And the function alphahull release an unordered set of points.
</span><span class="w">
  </span><span class="c1"># voronoi summits:
</span><span class="n">voronoi.summit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">rbind</span><span class="p">(</span><span class="n">voronoi.full</span><span class="p">[,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">mx1</span><span class="p">,</span><span class="w"> </span><span class="n">my1</span><span class="p">)],</span><span class="w"> </span><span class="n">voronoi.full</span><span class="p">[,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">mx2</span><span class="p">,</span><span class="w"> </span><span class="n">my2</span><span class="p">)],</span><span class="w"> </span><span class="n">use.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">))</span><span class="w">

  </span><span class="c1"># do a channel with the variables ind1 et ind2:
</span><span class="n">nb.edges</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">polygon.ext</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
  
  </span><span class="c1"># initialisation of the table:
</span><span class="n">order</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">nb.edges</span><span class="p">),</span><span class="w"> </span><span class="n">lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">nb.edges</span><span class="p">),</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">nb.edges</span><span class="p">),</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">

  </span><span class="c1"># new table to modify:
</span><span class="n">polygon.ext2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polygon.ext</span><span class="w">

</span><span class="n">order</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polygon.ext2</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ind1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"x1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"y1"</span><span class="p">)]</span><span class="w">
</span><span class="n">polygon.ext2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polygon.ext2</span><span class="p">[</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
  
  </span><span class="c1"># loop through the summits to select each time the next one:
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="w"> </span><span class="n">nb.edges</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1"># i &lt;- 2
</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">order</span><span class="p">[</span><span class="n">i</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">polygon.ext2</span><span class="o">$</span><span class="n">ind1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">order</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polygon.ext2</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">polygon.ext2</span><span class="o">$</span><span class="n">ind1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">order</span><span class="p">[</span><span class="n">i</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ind2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"x2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"y2"</span><span class="p">)]</span><span class="w">
  </span><span class="n">polygon.ext2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polygon.ext2</span><span class="p">[</span><span class="o">-</span><span class="n">which</span><span class="p">(</span><span class="n">polygon.ext2</span><span class="o">$</span><span class="n">ind1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">order</span><span class="p">[</span><span class="n">i</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]),</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">order</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polygon.ext2</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">polygon.ext2</span><span class="o">$</span><span class="n">ind2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">order</span><span class="p">[</span><span class="n">i</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ind1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"x1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"y1"</span><span class="p">)]</span><span class="w">
  </span><span class="n">polygon.ext2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polygon.ext2</span><span class="p">[</span><span class="o">-</span><span class="n">which</span><span class="p">(</span><span class="n">polygon.ext2</span><span class="o">$</span><span class="n">ind2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">order</span><span class="p">[</span><span class="n">i</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]),</span><span class="w"> </span><span class="p">]}</span><span class="w">
</span><span class="p">}</span><span class="w">

  </span><span class="c1"># list of voronoi summits which are in the polygon:
</span><span class="n">voronoi.constrain</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.table</span><span class="p">(</span><span class="n">pnt.in.poly</span><span class="p">(</span><span class="n">voronoi.summit</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"lon"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lat"</span><span class="p">)]))</span><span class="w">

  </span><span class="c1"># voronoi inside the polygon:
</span><span class="n">voronoi.part</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">voronoi.full</span><span class="p">,</span><span class="w"> </span><span class="n">voronoi.constrain</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"mx1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"my1"</span><span class="p">),</span><span class="w"> </span><span class="n">all.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">setnames</span><span class="p">(</span><span class="n">voronoi.constrain</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"mx1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"my1"</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"mx2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"my2"</span><span class="p">))</span><span class="w">
</span><span class="n">voronoi.part</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">voronoi.part</span><span class="p">,</span><span class="w"> </span><span class="n">voronoi.constrain</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"mx2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"my2"</span><span class="p">),</span><span class="w"> </span><span class="n">all.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">

   </span><span class="c1"># plot the voronoi diagram with constraint &amp; only inside edge of voronoi diagram:
</span><span class="n">zones.london.vor</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">zones.london</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_segment</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">polygon.ext</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_segment</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">voronoi.part</span><span class="p">[</span><span class="n">pip.x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">pip.y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mx2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my2</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mx1</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my1</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span><span class="p">)</span><span class="w"> 
</span><span class="n">zones.london.vor</span></code></pre></figure>

<p><img src="http://data-laborer.eu/assets/images/figures/source/2015-07-16-Voronoi_station/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /></p>

<h3>  Finding the furthest point from the subway </h3>

<p>I am looking for the voronoi summit the furthest from any subway station.
I use the <code class="highlighter-rouge">spDistsN1</code> function to calculate the distance on a sphere.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### Finding the furthest point:
</span><span class="w">  </span><span class="c1"># voronoi summit in the polygon
</span><span class="n">voronoi.constrain.lim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">voronoi.constrain</span><span class="p">[</span><span class="n">pip</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">mx2</span><span class="p">,</span><span class="w"> </span><span class="n">my2</span><span class="p">)]</span><span class="w">

  </span><span class="c1"># matrix of distance between all the station and the voronoi summits: 
</span><span class="n">matrix.dist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">voronoi.constrain.lim</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">eachPoint</span><span class="p">)</span><span class="w"> </span><span class="n">spDistsN1</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">coord.station.min</span><span class="p">[,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">)]),</span><span class="w"> </span><span class="n">eachPoint</span><span class="p">,</span><span class="w"> </span><span class="n">longlat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">))</span><span class="w">

  </span><span class="c1"># for each colum, the lowest distance:
</span><span class="n">min.dist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">matrix.dist</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">)</span><span class="w">

  </span><span class="c1"># coordonates of the furthest point:
</span><span class="n">min.coordinates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">voronoi.constrain.lim</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">matrix.dist</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">min.dist</span><span class="p">),</span><span class="w"> </span><span class="n">arr.ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)[</span><span class="m">2</span><span class="p">]]</span><span class="w">

  </span><span class="c1"># Thirdly, plotting the point:
</span><span class="n">zones.london.point</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">zones.london.vor</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min.coordinates</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mx2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my2</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">annotate</span><span class="p">(</span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min.coordinates</span><span class="o">$</span><span class="n">mx2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min.coordinates</span><span class="o">$</span><span class="n">my2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.003</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"The albert memorial"</span><span class="p">)</span><span class="w">
</span><span class="n">zones.london.point</span></code></pre></figure>

<p><img src="http://data-laborer.eu/assets/images/figures/source/2015-07-16-Voronoi_station/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" /></p>

<p>In the end, it appears that the furthest point from the subway in London is near the Albert memorial. If you already find yourself hanging there and thinking that the next subway station was quite far, be rassured, it’s definitely normal. :)</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://data-laborer.eu/tags/#alphahull" class="page__taxonomy-item" rel="tag">alphahull</a><span class="sep">, </span>
    
      
      
      <a href="https://data-laborer.eu/tags/#data-visualisation" class="page__taxonomy-item" rel="tag">data visualisation</a><span class="sep">, </span>
    
      
      
      <a href="https://data-laborer.eu/tags/#geometry" class="page__taxonomy-item" rel="tag">geometry</a><span class="sep">, </span>
    
      
      
      <a href="https://data-laborer.eu/tags/#r" class="page__taxonomy-item" rel="tag">R</a><span class="sep">, </span>
    
      
      
      <a href="https://data-laborer.eu/tags/#statistic" class="page__taxonomy-item" rel="tag">Statistic</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://data-laborer.eu/categories/#data-visualisation" class="page__taxonomy-item" rel="tag">Data visualisation</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2015-07-16T00:00:00+01:00">July 16, 2015</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=SwiftAMHE&text=How Far am I From the Next Tube Station? https://data-laborer.eu/data%20visualisation/Voronoi_station/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https://data-laborer.eu/data%20visualisation/Voronoi_station/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https://data-laborer.eu/data%20visualisation/Voronoi_station/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://data-laborer.eu/data%20visualisation/Voronoi_station/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="https://data-laborer.eu/hack/Mail_to_senateur/" class="pagination--pager" title="Send an Email to all your Representatives. With R.
">Previous</a>
    
    
      <a href="https://data-laborer.eu/statistic/Number_of_Cluster/" class="pagination--pager" title="August Coding Dojo: Choosing the Optimal Number of Cluster
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
    <h4 class="page__comments-title">Leave a Comment</h4>
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "https://data-laborer.eu/assets/images/Hausd%C3%BClmen_--_2009_--_0706.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://data-laborer.eu/hack/embedocputest/" rel="permalink">Include R Output in your Blog Pages with Opencpu
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-calendar-o" aria-hidden="true"></i> Nov 27, 2016  &nbsp; <i class="fa fa-clock-o" aria-hidden="true"></i> 




  1 minute read
 </p>
	        
    <p class="archive__item-excerpt" itemprop="description">Short exemple of how to include R output in a blog post with opencpu
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "https://data-laborer.eu/assets/images/Hausd%C3%BClmen_--_2009_--_0706.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://data-laborer.eu/r/Flexocpu/" rel="permalink">Dashboarding with Flexdashboard and Opencpu
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-calendar-o" aria-hidden="true"></i> Oct 31, 2016  &nbsp; <i class="fa fa-clock-o" aria-hidden="true"></i> 




  7 minute read
 </p>
	        
    <p class="archive__item-excerpt" itemprop="description">How to use opencpu as a back end for flexdashboard
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "https://data-laborer.eu/assets/images/Hausd%C3%BClmen_--_2009_--_0706.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://data-laborer.eu/earl/EARL_2016_review/" rel="permalink">EARL 2016 Review
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-calendar-o" aria-hidden="true"></i> Sep 20, 2016  &nbsp; <i class="fa fa-clock-o" aria-hidden="true"></i> 




  12 minute read
 </p>
	        
    <p class="archive__item-excerpt" itemprop="description">EARL 2016 review
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "https://data-laborer.eu/assets/images/Hausd%C3%BClmen_--_2009_--_0706.jpg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://data-laborer.eu/hack/Second_ropencorporate_pckg/" rel="permalink">Explore Company Officers of EDF with Ropencorporate
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-calendar-o" aria-hidden="true"></i> May 22, 2016  &nbsp; <i class="fa fa-clock-o" aria-hidden="true"></i> 




  12 minute read
 </p>
	        
    <p class="archive__item-excerpt" itemprop="description">Exemple of how to use the Ropencorporate package
</p>
  </article>
</div>
        
      </div>
    </div>
  
</div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/SwiftAMHE"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/YvesCR"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://data-laborer.eu/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2016 Yves Crutain. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="https://data-laborer.eu/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71940303-1', 'auto');
  ga('send', 'pageview');
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'datalaborereu';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>
