<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Messing with T-Distributed Stochastic Neighbor Embedding - Data laborer</title>




<meta name="description" content="Exemple of use of TSNE to create astonishing graphs">




<meta property="og:locale" content="en">
<meta property="og:site_name" content="Data laborer">
<meta property="og:title" content="Messing with T-Distributed Stochastic Neighbor Embedding">


  <link rel="canonical" href="https://data-laborer.eu/data%20visualisation/RTNSE_blog/">
  <meta property="og:url" content="https://data-laborer.eu/data%20visualisation/RTNSE_blog/">



  <meta property="og:description" content="Exemple of use of TSNE to create astonishing graphs">



  <meta name="twitter:site" content="@SwiftAMHE">
  <meta name="twitter:title" content="Messing with T-Distributed Stochastic Neighbor Embedding">
  <meta name="twitter:description" content="Exemple of use of TSNE to create astonishing graphs">
  <meta name="twitter:url" content="https://data-laborer.eu/data%20visualisation/RTNSE_blog/">

  
    <meta name="twitter:card" content="summary">
    
  

  







  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2015-09-14T00:00:00+01:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Yves Crutain",
      "url" : "https://data-laborer.eu",
      "sameAs" : ["https://twitter.com/swiftamhe","https://www.linkedin.com/in/yves-crutain-0b430324"]
    }
  </script>






<!-- end SEO -->


<link href="https://data-laborer.eu/feed.xml" type="application/atom+xml" rel="alternate" title="Data laborer Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://data-laborer.eu/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--default">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://data-laborer.eu/">Data laborer</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/portfolio/">List View</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/categories/">Categories</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/tags/">Tags</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/about/index.html">About</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

<p>Recently, Kaggle launch the scripts project, which is a board of scripts released by competitioners with possibilites of evaluations by peers.</p>

<p>One of the script is a scatterplot obtained through t-distributed stochastic neighbor embedding which summarise the information of a huge data set.</p>

<p>The scatterplot was so self explaining that I wanted to explore that method.</p>

<h3> Theory </h3>

<p>The theory is not that complicated after you get the concept of the idea behind.
The original paper is <a href="http://jmlr.org/papers/volume9/vandermaaten08a/vandermaaten08a.pdf">this one</a>.</p>

<p>t-SNE is mainly used to visualise huge data set into scatterplot. It reduces the dimensionality of data to 2 or 3 dimensions, allowing to do 2d or 3d plot.</p>

<table>
  <tbody>
    <tr>
      <td>t-SNE converts distances between datapoint in the original space into conditionnal probabilities $p_{j</td>
      <td>i}$.</td>
    </tr>
  </tbody>
</table>

<script type="math/tex; mode=display">p_{j|i} = \frac{\exp{(-d(\boldsymbol{x}_i, \boldsymbol{x}_j) / (2 \sigma_i^2)})}{\sum_{i \neq k} \exp{(-d(\boldsymbol{x}_i, \boldsymbol{x}_k) / (2 \sigma_i^2)})}, \quad p_{i|i} = 0,</script>

<p>$\sigma_i$ is the variance of the gaussian which is centered on $\boldsymbol{x}_i$. The <code class="highlighter-rouge">perplexity</code> parameter of the algorithm can influence this value.</p>

<table>
  <tbody>
    <tr>
      <td>If two points are close, $p_{j</td>
      <td>i}$ will be high. If two points are far, $p_{j</td>
      <td>i}$ will be low.</td>
    </tr>
  </tbody>
</table>

<p>The conditionnal probabilities are used to define the joint probabilities: 
<script type="math/tex">p_{ij} = \frac{p_{j|i} + p_{i|j}}{2N}.</script></p>

<p>The distances in the embedded space could be described the same way:</p>

<script type="math/tex; mode=display">q_{ij} = \frac{(1 + ||\boldsymbol{y}_i - \boldsymbol{y}_j)||^2)^{-1}}{\sum_{k \neq l} (1 + ||\boldsymbol{y}_k - \boldsymbol{y}_l)||^2)^{-1}},</script>

<p>The idea now is, for a good visualisation in the embedded space, $q_{ij}$ and $p_{ij}$ should be equal.</p>

<p>The Kullback-Leibler divergence is the measure used to calculate the mismatch between $q_{ij}$ and $p_{ij}$.</p>

<script type="math/tex; mode=display">KL(P|Q) = \sum_{i \neq j} p_{ij} \log \frac{p_{ij}}{q_{ij}}</script>

<p>A gradient descent is used to minimise this mismatch.</p>

<h3> The function </h3>

<p>The package <code class="highlighter-rouge">Rtsne</code> have one function, ` Rtsne()`. To note:</p>

<ul style="square">
<li> The function does not allow duplicates</li>
<li> The SNE result is fairly robust to change in perplexity. Classic values are between 5 and 50 </li>
<li> By defaut, an initial pca is made to reduce the number of dimensions before the SNE is done. </li>
<li> There is no normalisation made. Consequently, a variable with huge value will appear well separated. </li>
<li> The algorithm accept only numeric variables.</li>
<ul style="circle">
<li> Consequently, I personnaly like to divide my dummie variable by the number of modality. </li>
<li> When I want a specific variable to appear well organised, I increase artificially the value. </li>
</ul>
</ul>

<h3> Exemple </h3>

<p>Libraries used:</p>

<pre><code class="prettyprint ">library(data.table)
library(ggplot2)
library(Rtsne)</code></pre>

<h4> Diamond data set </h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># data table format:
</span><span class="n">diamonds.dt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.table</span><span class="p">(</span><span class="n">diamonds</span><span class="p">)</span><span class="w">

</span><span class="c1"># We transform ordinal variable into numeric one:
</span><span class="n">diamonds.dt</span><span class="p">[,</span><span class="w"> </span><span class="n">cut2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">cut</span><span class="p">)]</span><span class="w">
</span><span class="n">diamonds.dt</span><span class="p">[,</span><span class="w"> </span><span class="n">clarity2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">clarity</span><span class="p">)]</span><span class="w">
</span><span class="n">diamonds.dt</span><span class="p">[,</span><span class="w"> </span><span class="n">color2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">color</span><span class="p">)]</span><span class="w">

</span><span class="c1"># Normalization of each variable:
</span><span class="n">diamonds.dt2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">diamonds.dt</span><span class="p">[,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">.SD</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span><span class="w"> </span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="n">cut</span><span class="p">,</span><span class="w"> </span><span class="n">clarity</span><span class="p">),</span><span class="w"> </span><span class="n">.SDcols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"carat"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cut2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"color2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"clarity2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"depth"</span><span class="p">,</span><span class="w"> </span><span class="s2">"table"</span><span class="p">,</span><span class="w"> </span><span class="s2">"price"</span><span class="p">,</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="s2">"z"</span><span class="p">)]</span><span class="w">

</span><span class="c1"># deduplication:
</span><span class="n">diamonds.dt3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">diamonds.dt2</span><span class="p">[,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.N</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"carat"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cut2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"color2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"clarity2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"depth"</span><span class="p">,</span><span class="w"> </span><span class="s2">"table"</span><span class="p">,</span><span class="w"> </span><span class="s2">"price"</span><span class="p">,</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="s2">"z"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cut"</span><span class="p">,</span><span class="w"> </span><span class="s2">"color"</span><span class="p">,</span><span class="w"> </span><span class="s2">"clarity"</span><span class="p">)]</span><span class="w">

</span><span class="n">diamonds.dt4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">diamonds.dt3</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"carat"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cut2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"color2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"clarity2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"depth"</span><span class="p">,</span><span class="w"> </span><span class="s2">"table"</span><span class="p">,</span><span class="w"> </span><span class="s2">"price"</span><span class="p">,</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="s2">"z"</span><span class="p">),</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">]</span><span class="w">

</span><span class="c1"># Embedding the data set:
</span><span class="n">diamonds.2d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Rtsne</span><span class="p">(</span><span class="n">diamonds.dt4</span><span class="p">,</span><span class="w"> </span><span class="n">dims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">initial_dims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">perplexity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">max_iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">600</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">save</span><span class="p">(</span><span class="n">diamonds.2d</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"./DATA/diamonds_2d.rdata"</span><span class="p">)</span><span class="w">

</span><span class="n">diamonds.dt3</span><span class="p">[,</span><span class="w"> </span><span class="n">x.rtsne</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">diamonds.2d</span><span class="o">$</span><span class="n">Y</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">diamonds.dt3</span><span class="p">[,</span><span class="w"> </span><span class="n">y.rtsne</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">diamonds.2d</span><span class="o">$</span><span class="n">Y</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]]</span></code></pre></figure>

<pre><code class="prettyprint "># colorless
ggplot(data = diamonds.dt4, aes(x = x.rtsne, y = y.rtsne)) +
  geom_point(color = &quot;black&quot;) +
  ggtitle(&quot;Raw plot&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" /></p>

<pre><code class="prettyprint "># clarity
ggplot(data = diamonds.dt4, aes(x = x.rtsne, y = y.rtsne, color = as.factor(clarity2)))+
  geom_point() +   theme_classic() +  ggtitle(&quot;Clarity&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5" /></p>

<pre><code class="prettyprint "># cut
ggplot(data = diamonds.dt4, aes(x = x.rtsne, y = y.rtsne, color = as.factor(cut2))) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Cut&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-5-3.png" alt="plot of chunk unnamed-chunk-5" /></p>

<pre><code class="prettyprint "># price
ggplot(data = diamonds.dt4, aes(x = x.rtsne, y = y.rtsne, color = price)) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Price&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-5-4.png" alt="plot of chunk unnamed-chunk-5" /></p>

<pre><code class="prettyprint "># color
ggplot(data = diamonds.dt4, aes(x = x.rtsne, y = y.rtsne, color = as.factor(color2))) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Color&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-5-5.png" alt="plot of chunk unnamed-chunk-5" /></p>

<pre><code class="prettyprint "># carat
ggplot(data = diamonds.dt4, aes(x = x.rtsne, y = y.rtsne, color = carat)) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Carat&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-5-6.png" alt="plot of chunk unnamed-chunk-5" /></p>

<pre><code class="prettyprint "># x
ggplot(data = diamonds.dt4, aes(x = x.rtsne, y = y.rtsne, color = x)) +
  geom_point() +   theme_classic() +  ggtitle(&quot;X&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-5-7.png" alt="plot of chunk unnamed-chunk-5" /></p>

<pre><code class="prettyprint "># y
ggplot(data = diamonds.dt4, aes(x = x.rtsne, y = y.rtsne, color = y)) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Y&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-5-8.png" alt="plot of chunk unnamed-chunk-5" /></p>

<pre><code class="prettyprint "># z
ggplot(data = diamonds.dt4, aes(x = x.rtsne, y = y.rtsne, color = z)) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Z&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-5-9.png" alt="plot of chunk unnamed-chunk-5" /></p>

<pre><code class="prettyprint "># depth
ggplot(data = diamonds.dt4, aes(x = x.rtsne, y = y.rtsne, color = depth)) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Depth&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-5-10.png" alt="plot of chunk unnamed-chunk-5" /></p>

<h4> Titanic data set </h4>

<p>The goal in the titanic data set is to predict the Survivor.
Here, we will try to plot the 2D representation of the data set without using the Survivor variable. If the final graph separate the Survivors from the non survivors, it is possible to analyse the variables to use in the survival model.</p>

<p>It is possible to influence the graph weighting the variable used.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># read the data:
</span><span class="n">setwd</span><span class="p">(</span><span class="s2">"C:/blog/gen"</span><span class="p">)</span><span class="w">
</span><span class="n">titanic.train</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fread</span><span class="p">(</span><span class="s2">"./data/train_rtnse.csv"</span><span class="p">)</span><span class="w">

</span><span class="c1"># get read of qualitative variables. The dummies variable of the Embarked variable are weighted to count for 1 in the count of the variables:
</span><span class="n">titanic.train</span><span class="p">[,</span><span class="w"> </span><span class="n">flg.M</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">Sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"male"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w">
</span><span class="n">titanic.train</span><span class="p">[,</span><span class="w"> </span><span class="n">flg.emb.s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">Embarked</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"S"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w">
</span><span class="n">titanic.train</span><span class="p">[,</span><span class="w"> </span><span class="n">flg.emb.c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">Embarked</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"C"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w">
</span><span class="n">titanic.train</span><span class="p">[,</span><span class="w"> </span><span class="n">flg.emb.q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">Embarked</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Q"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w">

</span><span class="c1"># get read of duplicate values:
</span><span class="n">titanic.train2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">titanic.train</span><span class="p">[,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.N</span><span class="p">,</span><span class="w"> </span><span class="n">Survived2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">Survived</span><span class="p">)),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">Pclass</span><span class="p">,</span><span class="w"> </span><span class="n">flg.M</span><span class="p">,</span><span class="w"> </span><span class="n">flg.emb.s</span><span class="p">,</span><span class="w"> </span><span class="n">flg.emb.c</span><span class="p">,</span><span class="w"> </span><span class="n">flg.emb.q</span><span class="p">,</span><span class="w"> </span><span class="n">Age</span><span class="p">,</span><span class="w"> </span><span class="n">SibSp</span><span class="p">,</span><span class="w"> </span><span class="n">Parch</span><span class="p">,</span><span class="w"> </span><span class="n">Fare</span><span class="p">,</span><span class="w"> </span><span class="n">Embarked</span><span class="p">)]</span><span class="w">

</span><span class="c1"># get read of missing values and normalisation:
</span><span class="n">titanic.train2</span><span class="p">[,</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">Age</span><span class="p">),</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">Age</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">Age</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">Age</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">Age</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)))]</span><span class="w">
</span><span class="n">titanic.train2</span><span class="p">[,</span><span class="w"> </span><span class="n">Pclass</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="n">Pclass</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">Pclass</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">Pclass</span><span class="p">)</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">Pclass</span><span class="p">))]</span><span class="w">
</span><span class="n">titanic.train2</span><span class="p">[,</span><span class="w"> </span><span class="n">Pclass</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="n">Pclass</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">Pclass</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">Pclass</span><span class="p">)</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">Pclass</span><span class="p">))]</span><span class="w">
</span><span class="n">titanic.train2</span><span class="p">[,</span><span class="w"> </span><span class="n">Fare</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">Fare</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">Fare</span><span class="p">)</span><span class="o">/</span><span class="nf">max</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">Fare</span><span class="p">)))]</span><span class="w">
</span><span class="n">titanic.train2</span><span class="p">[,</span><span class="w"> </span><span class="n">SibSp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="n">SibSp</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">SibSp</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">SibSp</span><span class="p">)</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">SibSp</span><span class="p">))]</span></code></pre></figure>

<p>With a huge table, the function could take a while.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">res.rtnse</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Rtsne</span><span class="p">(</span><span class="n">titanic.train2</span><span class="p">[,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">Pclass</span><span class="p">,</span><span class="w"> </span><span class="n">flg.M</span><span class="p">,</span><span class="w"> </span><span class="n">flg.emb.s</span><span class="p">,</span><span class="w"> </span><span class="n">flg.emb.c</span><span class="p">,</span><span class="w"> </span><span class="n">flg.emb.q</span><span class="p">,</span><span class="w"> </span><span class="n">Age</span><span class="p">,</span><span class="w"> </span><span class="n">SibSp</span><span class="p">,</span><span class="w"> </span><span class="n">Parch</span><span class="p">,</span><span class="w"> </span><span class="n">Fare</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)],</span><span class="w"> </span><span class="n">dims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">perplexity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">max_iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">titanic.train2</span><span class="p">[,</span><span class="w"> </span><span class="n">x.rtsne</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">res.rtnse</span><span class="o">$</span><span class="n">Y</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">titanic.train2</span><span class="p">[,</span><span class="w"> </span><span class="n">y.rtsne</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">res.rtnse</span><span class="o">$</span><span class="n">Y</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]]</span></code></pre></figure>

<pre><code class="prettyprint "># Raw plot:
ggplot(data = titanic.train2, aes(x = x.rtsne, y = y.rtsne)) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Raw graph&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" /></p>

<p>The 2D representation create clusters easily identifiable. Now, the question is: does these clusters make sense looking at the survivor variable.</p>

<pre><code class="prettyprint "># Survived:
ggplot(data = titanic.train2, aes(x = x.rtsne, y = y.rtsne, color = Survived2))  +
  geom_point() +   theme_classic() +  ggtitle(&quot;Survivors&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" /></p>

<p>The survivors are not that well separated, but we could see a few groups which are well defined.</p>

<pre><code class="prettyprint "># Age
ggplot(data = titanic.train2, aes(x = x.rtsne, y = y.rtsne, color = Age)) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Age&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /></p>

<pre><code class="prettyprint "># Pclass
ggplot(data = titanic.train2, aes(x = x.rtsne, y = y.rtsne, color = as.factor(Pclass))) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Class&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-11-2.png" alt="plot of chunk unnamed-chunk-11" /></p>

<pre><code class="prettyprint "># Sex
ggplot(data = titanic.train2, aes(x = x.rtsne, y = y.rtsne, color = as.factor(flg.M))) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Sex&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-11-3.png" alt="plot of chunk unnamed-chunk-11" /></p>

<pre><code class="prettyprint "># Parch
ggplot(data = titanic.train2, aes(x = x.rtsne, y = y.rtsne, color = Parch))  +
  geom_point() +   theme_classic() +  ggtitle(&quot;Number of Parents/Children Aboard&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-11-4.png" alt="plot of chunk unnamed-chunk-11" /></p>

<pre><code class="prettyprint "># Fare
ggplot(data = titanic.train2, aes(x = x.rtsne, y = y.rtsne, color = Fare))  +
  geom_point() +   theme_classic() +  ggtitle(&quot;Fare&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-11-5.png" alt="plot of chunk unnamed-chunk-11" /></p>

<pre><code class="prettyprint "># SibSp
ggplot(data = titanic.train2, aes(x = x.rtsne, y = y.rtsne, color = SibSp))  +
  geom_point() +   theme_classic() +  ggtitle(&quot;Number of Siblings/Spouses Aboard&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-11-6.png" alt="plot of chunk unnamed-chunk-11" /></p>

<pre><code class="prettyprint "># flg.emb.s
ggplot(data = titanic.train2, aes(x = x.rtsne, y = y.rtsne, color = flg.emb.s)) +
  geom_point() +   theme_classic() +  ggtitle(&quot;Embarkation at Southampton&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-11-7.png" alt="plot of chunk unnamed-chunk-11" /></p>

<pre><code class="prettyprint "># flg.emb.c
ggplot(data = titanic.train2, aes(x = x.rtsne, y = y.rtsne, color = flg.emb.c))  +
  geom_point() +   theme_classic() +  ggtitle(&quot;Embarkation at Cherbourg&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-11-8.png" alt="plot of chunk unnamed-chunk-11" /></p>

<pre><code class="prettyprint "># flg.emb.q
ggplot(data = titanic.train2, aes(x = x.rtsne, y = y.rtsne, color = flg.emb.q))  +
  geom_point() +   theme_classic() +  ggtitle(&quot;Embarkation at Queenstown&quot;)</code></pre>

<p><img src="http://data-laborer.euassets/images/figures/source/2015-09-09-RTNSE_blog/unnamed-chunk-11-9.png" alt="plot of chunk unnamed-chunk-11" /></p>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/SwiftAMHE"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/YvesCR"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://data-laborer.eu/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2017 Yves Crutain. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="https://data-laborer.eu/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71940303-1', 'auto');
  ga('send', 'pageview');
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'datalaborereu';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>
