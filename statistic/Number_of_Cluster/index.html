<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>August Coding Dojo: Choosing the Optimal Number of Cluster - Data laborer</title>




<meta name="description" content="How to automatically define the optimal number of cluster when doing clustering?">




<meta property="og:locale" content="en">
<meta property="og:site_name" content="Data laborer">
<meta property="og:title" content="August Coding Dojo: Choosing the Optimal Number of Cluster">


  <link rel="canonical" href="https://data-laborer.eu/statistic/Number_of_Cluster/">
  <meta property="og:url" content="https://data-laborer.eu/statistic/Number_of_Cluster/">



  <meta property="og:description" content="How to automatically define the optimal number of cluster when doing clustering?">



  <meta name="twitter:site" content="@SwiftAMHE">
  <meta name="twitter:title" content="August Coding Dojo: Choosing the Optimal Number of Cluster">
  <meta name="twitter:description" content="How to automatically define the optimal number of cluster when doing clustering?">
  <meta name="twitter:url" content="https://data-laborer.eu/statistic/Number_of_Cluster/">

  
    <meta name="twitter:card" content="summary">
    
  

  







  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2015-08-18T00:00:00+01:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Yves Crutain",
      "url" : "https://data-laborer.eu",
      "sameAs" : ["https://twitter.com/swiftamhe","https://www.linkedin.com/in/yves-crutain-0b430324"]
    }
  </script>






<!-- end SEO -->


<link href="https://data-laborer.eu/feed.xml" type="application/atom+xml" rel="alternate" title="Data laborer Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://data-laborer.eu/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://data-laborer.eu/">Data laborer</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/portfolio/">List View</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/categories/">Categories</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/tags/">Tags</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://data-laborer.eu/about/index.html">About</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    



<div id="main" role="main">
  

  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="August Coding Dojo: Choosing the Optimal Number of Cluster">
    <meta itemprop="description" content="How to automatically define the optimal number of cluster when doing clustering?">
    <meta itemprop="datePublished" content="August 18, 2015">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">August Coding Dojo: Choosing the Optimal Number of Cluster
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  4 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>At the last coding dojo, the interrogation we get was the following:
Is it possible to create a function which automatically define the optimal number of cluster?
As usual, the answer with R is: there is a package for that.</p>

<h2> Training data set </h2>

<p>First, we generate some fake data:
Not too much separated, but not too messy. It is a simulation, not real life :)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>library(ggplot2)

sd &lt;- 30

mat = data.frame(x =c(seq(1,10),seq(100,120),seq(10:30)) + rnorm(52, 0, sd), 
                 y = c(seq(1,10),seq(100,120),seq(300,320))+ rnorm(52, 0, sd)
                 , c = c(rep("a", 10), rep("b", 21), rep("c", 21)))

ggplot(data = mat, aes(x = x, y = y)) +
    geom_point( size = 4) 
</code></pre>
</div>

<p><img src="http://data-laborer.eu/assets/images/figures/source/2015-08-18-Number_of_Cluster/unnamed-chunk-1-1.png" alt="plot of chunk unnamed-chunk-1" /></p>

<h2> Analysis </h2>

<h3> Elbow plot </h3>

<p>Our main inspiration is that post on stackoverflow:</p>

<p><a href="http://stackoverflow.com/questions/15376075/cluster-analysis-in-r-determine-the-optimal-number-of-clusters">http://stackoverflow.com/questions/15376075/cluster-analysis-in-r-determine-the-optimal-number-of-clusters</a></p>

<p>And the help of the Nbclust package.</p>

<p>The first way to determine a reasonnable number of cluster that was taught at school was the elbow plot.
The concept is to plot the sum of the distance between the centroid of the cluster and the point of the cluster by cluster.</p>

<p>The plot looks like an elbow and the classic rule is to take the number of cluster where the curve begin to flaten. Afterward, each new cluster is not really separated from the others.</p>

<p>Elbow plot:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>wss &lt;- (nrow(mat)-1)*sum(apply(mat[, -3],2,var))
  for (i in 2:15) wss[i] &lt;- sum(kmeans(mat[, -3],
                                       centers=i)$withinss)

wss2 &lt;- data.frame(x = 1:15, wss = wss)

ggplot(data = wss2, aes(x = x, y = wss))+
    geom_point(size = 4) +
  geom_line() +
  scale_x_continuous(breaks = 1:15) +
  ggtitle("Elbow plot")
</code></pre>
</div>

<p><img src="http://data-laborer.eu/assets/images/figures/source/2015-08-18-Number_of_Cluster/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /></p>

<h3> The function NbClust </h3>

<p>The function NbClust test a consequent set of methods to determine the optimal number of clusters.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>res &lt;- NbClust(mat[, -3], diss=NULL, distance = "euclidean", min.nc=2, max.nc=6, 
             method = "kmeans", index = "all")
</code></pre>
</div>

<p>The different method used (minus the graphical ones) and the number of clusters picked by each:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>res$Best.nc

##                       KL       CH Hartigan     CCC   Scott     Marriot
## Number_clusters   3.0000   3.0000   3.0000  4.0000  3.0000           3
## Value_Index     149.0192 225.3661  64.9168 13.1914 77.2724 20026685783
##                    TrCovW   TraceW Friedman   Rubin Cindex     DB
## Number_clusters         4      3.0   3.0000  3.0000 2.0000 2.0000
## Value_Index     772848467 133283.6  37.3399 -7.9366 0.3183 0.5111
##                 Silhouette   Duda PseudoT2  Beale Ratkowsky     Ball
## Number_clusters      2.000 2.0000   2.0000 2.0000    3.0000     3.00
## Value_Index          0.665 0.2922  70.2388 2.3413    0.5163 95039.14
##                 PtBiserial Frey McClain   Dunn Hubert SDindex Dindex
## Number_clusters     2.0000    1  2.0000 2.0000      0  2.0000      0
## Value_Index         0.8207   NA  0.3386 0.4647      0  0.0156      0
##                   SDbw
## Number_clusters 3.0000
## Value_Index     0.1679
</code></pre>
</div>

<p>Most common value:(Without 0)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>summary(res$Best.nc[1,][res$Best.nc[1,]!= 0])

##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.000   2.000   3.000   2.583   3.000   4.000
</code></pre>
</div>

<p>In the end, the median of all these methods is choosed. In this case, 3.</p>

<h2> Result </h2>

<p>The plot:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mat$res &lt;- res$Best.partition

ggplot(data = mat, aes(x = x, y = y, colour = factor(res))) +
    geom_point( size = 4)
</code></pre>
</div>

<p><img src="http://data-laborer.eu/assets/images/figures/source/2015-08-18-Number_of_Cluster/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" /></p>

<p>There is another approach we didnâ€™t had time to look at, but which seems promising:
The package BHC which does bayesian hierarchical clustering could also provide us an insight on the best cluster.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://data-laborer.eu/tags/#clustering" class="page__taxonomy-item" rel="tag">Clustering</a><span class="sep">, </span>
    
      
      
      <a href="https://data-laborer.eu/tags/#ggplot2" class="page__taxonomy-item" rel="tag">ggplot2</a><span class="sep">, </span>
    
      
      
      <a href="https://data-laborer.eu/tags/#nbclust" class="page__taxonomy-item" rel="tag">NbClust</a><span class="sep">, </span>
    
      
      
      <a href="https://data-laborer.eu/tags/#r" class="page__taxonomy-item" rel="tag">R</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://data-laborer.eu/categories/#statistic" class="page__taxonomy-item" rel="tag">Statistic</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2015-08-18T00:00:00+01:00">August 18, 2015</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=SwiftAMHE&text=August Coding Dojo: Choosing the Optimal Number of Cluster https://data-laborer.eu/statistic/Number_of_Cluster/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https://data-laborer.eu/statistic/Number_of_Cluster/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https://data-laborer.eu/statistic/Number_of_Cluster/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://data-laborer.eu/statistic/Number_of_Cluster/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="https://data-laborer.eu/data%20visualisation/Voronoi_station/" class="pagination--pager" title="How Far am I From the Next Tube Station?
">Previous</a>
    
    
      <a href="https://data-laborer.eu/r/Tips-and-tricks/" class="pagination--pager" title="Tips and Tricks to Know in R
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
    <h4 class="page__comments-title">Leave a Comment</h4>
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "https://data-laborer.eu/assets/images/TheRapeofEuropa.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://data-laborer.eu/hack/embedocputest/" rel="permalink">Include R Output in your Blog Pages with Opencpu
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-calendar-o" aria-hidden="true"></i> Nov 27, 2016  &nbsp; <i class="fa fa-clock-o" aria-hidden="true"></i> 




  1 minute read
 </p>
	        
    <p class="archive__item-excerpt" itemprop="description">Short exemple of how to include R output in a blog post with opencpu
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "https://data-laborer.eu/assets/images/flexocpu.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://data-laborer.eu/r/Flexocpu/" rel="permalink">Dashboarding with Flexdashboard and Opencpu
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-calendar-o" aria-hidden="true"></i> Oct 31, 2016  &nbsp; <i class="fa fa-clock-o" aria-hidden="true"></i> 




  7 minute read
 </p>
	        
    <p class="archive__item-excerpt" itemprop="description">How to use opencpu as a back end for flexdashboard
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "https://data-laborer.eu/assets/images/earl.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://data-laborer.eu/earl/EARL_2016_review/" rel="permalink">EARL 2016 Review
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-calendar-o" aria-hidden="true"></i> Sep 20, 2016  &nbsp; <i class="fa fa-clock-o" aria-hidden="true"></i> 




  12 minute read
 </p>
	        
    <p class="archive__item-excerpt" itemprop="description">EARL 2016 review
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "https://data-laborer.eu/assets/images/logog_oc.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://data-laborer.eu/hack/Second_ropencorporate_pckg/" rel="permalink">Explore Company Officers of EDF with Ropencorporate
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-calendar-o" aria-hidden="true"></i> May 22, 2016  &nbsp; <i class="fa fa-clock-o" aria-hidden="true"></i> 




  12 minute read
 </p>
	        
    <p class="archive__item-excerpt" itemprop="description">Exemple of how to use the Ropencorporate package
</p>
  </article>
</div>
        
      </div>
    </div>
  
</div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/SwiftAMHE"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/YvesCR"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://data-laborer.eu/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2017 Yves Crutain. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="https://data-laborer.eu/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71940303-1', 'auto');
  ga('send', 'pageview');
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'datalaborereu';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>
